<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 설정 - Westory Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase -->
    <script type="module" src="../assets/js/firebase-config.js"></script>
    <link rel="stylesheet" href="../assets/css/style.css">
    <script type="module" src="../assets/js/auth-manager.js"></script>

    <style>
        .setting-sidebar {
            width: 250px;
            background-color: white;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
        }

        .sidebar-item {
            padding: 1rem 1.5rem;
            color: #4b5563;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 4px solid transparent;
            display: flex;
            align-items: center;
            text-decoration: none;
        }

        .sidebar-item:hover {
            background-color: #f9fafb;
            color: #1f2937;
        }

        .sidebar-item.active {
            background-color: #eff6ff;
            color: #2563eb;
            border-left-color: #2563eb;
        }

        .sidebar-item i {
            width: 24px;
            text-align: center;
            margin-right: 8px;
        }

        .content-area {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background-color: #f8fafc;
        }

        @media (max-width: 1024px) {
            .setting-sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e5e7eb;
                flex-direction: row;
                overflow-x: auto;
                padding-bottom: 0;
            }

            .setting-sidebar .p-6 {
                padding: 1rem;
            }

            .setting-sidebar h2 {
                font-size: 1rem;
            }

            .sidebar-item {
                border-left: none;
                border-bottom: 4px solid transparent;
                padding: 1rem;
                white-space: nowrap;
            }

            .sidebar-item.active {
                border-left-color: transparent;
                border-bottom-color: #2563eb;
            }

            .content-area {
                padding: 1.5rem;
            }
        }
    </style>
</head>

<body class="bg-gray-50 h-screen flex flex-col overflow-hidden">
    <!-- Header injected by AuthManager -->

    <main class="flex flex-col lg:flex-row flex-1 overflow-hidden">
        <!-- Sidebar -->
        <aside class="setting-sidebar shrink-0">
            <div class="p-6 border-b border-gray-100 lg:border-b-0 lg:border-gray-100">
                <h2 class="text-xl font-extrabold text-gray-800 flex items-center">
                    <i class="fas fa-cog text-gray-400 mr-2"></i> 관리자
                </h2>
            </div>
            <nav class="flex lg:flex-col flex-1 py-0 lg:py-4 overflow-x-auto">
                <a href="settings.html" class="sidebar-item active">
                    <i class="fas fa-sliders-h"></i>기본 환경 설정
                </a>
                <a href="settings_school.html" class="sidebar-item">
                    <i class="fas fa-school"></i>학교급·학년·학급
                </a>
                <a href="settings_interface.html" class="sidebar-item">
                    <i class="fas fa-palette"></i>인터페이스 설정
                </a>
                <a href="settings_privacy.html" class="sidebar-item">
                    <i class="fas fa-user-shield"></i>개인정보 동의 관리
                </a>
            </nav>
        </aside>

        <!-- Content -->
        <div class="content-area">

            <div class="bg-white rounded-xl border border-gray-200 p-6 lg:p-8 shadow-sm max-w-3xl">
                <div class="border-b border-gray-100 pb-4 mb-6">
                    <h3 class="text-lg font-bold text-gray-900">시스템 기본 설정</h3>
                    <p class="text-sm text-gray-500 mt-1">학년도, 학기 및 메뉴 표시 여부를 제어합니다.</p>
                </div>

                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">학년도</label>
                            <select id="global-config-year"
                                class="w-full border border-gray-300 rounded-lg p-3 bg-gray-50 focus:ring-2 focus:ring-blue-500 font-bold text-gray-800 outline-none">
                                <option value="2025">2025학년도</option>
                                <option value="2026">2026학년도</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">학기</label>
                            <select id="global-config-sem"
                                class="w-full border border-gray-300 rounded-lg p-3 bg-gray-50 focus:ring-2 focus:ring-blue-500 font-bold text-gray-800 outline-none">
                                <option value="1">1학기</option>
                                <option value="2">2학기</option>
                            </select>
                        </div>
                    </div>
                    <div
                        class="bg-amber-50 text-amber-800 text-xs p-3 rounded-lg border border-amber-200 font-bold flex items-start gap-2">
                        <i class="fas fa-exclamation-triangle mt-0.5"></i>
                        <span>학년도/학기를 변경하면 해당 기간의 데이터베이스로 즉시 전환됩니다. 학생들의 데이터 조회 범위도 변경됩니다.</span>
                    </div>

                    <div class="border-t border-gray-100 pt-6">
                        <label class="block text-sm font-bold text-gray-700 mb-4">학생 메뉴 표시 제어</label>
                        <div class="space-y-3">
                            <label
                                class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center">
                                        <i class="fas fa-gamepad"></i>
                                    </div>
                                    <span class="font-bold text-gray-700">평가(Quiz)</span>
                                </div>
                                <input type="checkbox" id="global-toggle-quiz"
                                    class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500">
                            </label>
                            <label
                                class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center">
                                        <i class="fas fa-chart-bar"></i>
                                    </div>
                                    <span class="font-bold text-gray-700">점수(Score)</span>
                                </div>
                                <input type="checkbox" id="global-toggle-score"
                                    class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500">
                            </label>
                            <label
                                class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center">
                                        <i class="fas fa-book-reader"></i>
                                    </div>
                                    <span class="font-bold text-gray-700">수업자료(Lesson)</span>
                                </div>
                                <input type="checkbox" id="global-toggle-lesson"
                                    class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500">
                            </label>
                        </div>
                    </div>

                    <div class="pt-4 text-right">
                        <button onclick="saveConfig()"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg transition transform active:scale-95">
                            설정 저장
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer injected by AuthManager -->

    <script type="module">
        window.AuthManager.init('teacher');

        // Expose functions globally for onclick handlers
        window.saveConfig = saveConfig;

        // Note: The previous code had functions defined at top level inside module.
        // We need to attach them to window.
        // Use window.currentConfig which is set by AuthManager or load it manually.

        document.addEventListener('auth-ready', () => {
            loadConfig();
        });

        function loadConfig() {
            const c = window.currentConfig;
            document.getElementById('global-config-year').value = c.year || '2025';
            document.getElementById('global-config-sem').value = c.semester || '2';
            document.getElementById('global-toggle-quiz').checked = c.showQuiz !== false;
            document.getElementById('global-toggle-score').checked = c.showScore !== false;
            document.getElementById('global-toggle-lesson').checked = c.showLesson !== false;
        }

        async function saveConfig() {
            const newConfig = {
                year: document.getElementById('global-config-year').value,
                semester: document.getElementById('global-config-sem').value,
                showQuiz: document.getElementById('global-toggle-quiz').checked,
                showScore: document.getElementById('global-toggle-score').checked,
                showLesson: document.getElementById('global-toggle-lesson').checked
            };
            try {
                await window.db.collection('site_settings').doc('config').set(newConfig, { merge: true });
                alert("기본 설정이 저장되었습니다. 변경 사항을 적용하기 위해 페이지를 새로고침합니다.");
                window.location.reload();
            } catch (e) { alert("설정 저장 실패: " + e.message); }
        }
    </script>
</body>

</html>