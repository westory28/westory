<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸í„°í˜ì´ìŠ¤ ì„¤ì • - Westory Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase -->
    <script type="module" src="../assets/js/firebase-config.js"></script>
    <link rel="stylesheet" href="../assets/css/style.css">
    <script type="module" src="../assets/js/auth-manager.js"></script>

    <style>
        .setting-sidebar {
            width: 250px;
            background-color: white;
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
        }

        .sidebar-item {
            padding: 1rem 1.5rem;
            color: #4b5563;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 4px solid transparent;
            display: flex;
            align-items: center;
            text-decoration: none;
        }

        .sidebar-item:hover {
            background-color: #f9fafb;
            color: #1f2937;
        }

        .sidebar-item.active {
            background-color: #eff6ff;
            color: #2563eb;
            border-left-color: #2563eb;
        }

        .sidebar-item i {
            width: 24px;
            text-align: center;
            margin-right: 8px;
        }

        .content-area {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background-color: #f8fafc;
        }

        @media (max-width: 1024px) {
            .setting-sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e5e7eb;
                flex-direction: row;
                overflow-x: auto;
                padding-bottom: 0;
            }

            .setting-sidebar .p-6 {
                padding: 1rem;
            }

            .setting-sidebar h2 {
                font-size: 1rem;
            }

            .sidebar-item {
                border-left: none;
                border-bottom: 4px solid transparent;
                padding: 1rem;
                white-space: nowrap;
            }

            .sidebar-item.active {
                border-left-color: transparent;
                border-bottom-color: #2563eb;
            }

            .content-area {
                padding: 1.5rem;
            }
        }
    </style>
</head>

<body class="bg-gray-50 h-screen flex flex-col overflow-hidden">
    <!-- Header injected by AuthManager -->

    <main class="flex flex-col lg:flex-row flex-1 overflow-hidden">
        <!-- Sidebar -->
        <aside class="setting-sidebar shrink-0">
            <div class="p-6 border-b border-gray-100 lg:border-b-0 lg:border-gray-100">
                <h2 class="text-xl font-extrabold text-gray-800 flex items-center">
                    <i class="fas fa-cog text-gray-400 mr-2"></i> ê´€ë¦¬ì
                </h2>
            </div>
            <nav class="flex lg:flex-col flex-1 py-0 lg:py-4 overflow-x-auto">
                <a href="settings.html" class="sidebar-item">
                    <i class="fas fa-sliders-h"></i>ê¸°ë³¸ í™˜ê²½ ì„¤ì •
                </a>
                <a href="settings_school.html" class="sidebar-item">
                    <i class="fas fa-school"></i>í•™êµê¸‰Â·í•™ë…„Â·í•™ê¸‰
                </a>
                <a href="settings_interface.html" class="sidebar-item active">
                    <i class="fas fa-palette"></i>ì¸í„°í˜ì´ìŠ¤ ì„¤ì •
                </a>
                <a href="settings_privacy.html" class="sidebar-item">
                    <i class="fas fa-user-shield"></i>ê°œì¸ì •ë³´ ë™ì˜ ê´€ë¦¬
                </a>
            </nav>
        </aside>

        <!-- Content -->
        <div class="content-area">
            <div class="max-w-3xl space-y-8">

                <!-- Section 1: Landing Page Text -->
                <div class="bg-white rounded-xl border border-gray-200 p-6 lg:p-8 shadow-sm">
                    <div class="border-b border-gray-100 pb-4 mb-6">
                        <h3 class="text-lg font-bold text-gray-900">
                            <i class="fas fa-home text-blue-500 mr-2"></i>ë©”ì¸ í™”ë©´ ì„¤ì •
                        </h3>
                        <p class="text-sm text-gray-500 mt-1">ë¡œê·¸ì¸(ë©”ì¸) í™”ë©´ì˜ ë¬¸êµ¬ì™€ ì´ëª¨ì§€ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.</p>
                    </div>

                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ë©”ì¸ ì´ëª¨ì§€</label>
                            <input type="text" id="main-emoji" placeholder="ì˜ˆ: ğŸ“š"
                                class="w-24 text-center text-2xl border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500 outline-none">
                            <p class="text-xs text-gray-400 mt-1">ì´ëª¨ì§€ 1ê°œë¥¼ ì…ë ¥í•˜ì„¸ìš”. (ìœˆë„ìš° í‚¤ + .)</p>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ì„œë¸Œ íƒ€ì´í‹€ (ë¬¸êµ¬)</label>
                            <input type="text" id="main-subtitle" placeholder="ì˜ˆ: ìš°ë¦¬ê°€ ì¨ ë‚´ë ¤ê°€ëŠ” ì´ì•¼ê¸°"
                                class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                    </div>
                </div>

                <!-- Section 2: D-Day -->
                <div class="bg-white rounded-xl border border-gray-200 p-6 lg:p-8 shadow-sm">
                    <div class="border-b border-gray-100 pb-4 mb-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-bold text-gray-900">
                                    <i class="fas fa-hourglass-half text-orange-500 mr-2"></i>D-Day í‘œì‹œ
                                </h3>
                                <p class="text-sm text-gray-500 mt-1">ë©”ì¸ í™”ë©´ì— D-Day ì¹´ìš´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="dday-enabled" class="sr-only peer"
                                    onchange="app.toggleDday()">
                                <div
                                    class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                                </div>
                                <span class="ml-3 text-sm font-medium text-gray-900">ì‚¬ìš©</span>
                            </label>
                        </div>
                    </div>

                    <div id="dday-content"
                        class="space-y-6 opacity-50 pointer-events-none transition-opacity duration-200">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ì œëª©</label>
                            <input type="text" id="dday-title" placeholder="ì˜ˆ: ìˆ˜ëŠ¥, ì¤‘ê°„ê³ ì‚¬"
                                class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ëª©í‘œ ë‚ ì§œ</label>
                            <input type="date" id="dday-date"
                                class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                    </div>
                </div>

                <!-- Save Button -->
                <div class="text-right pb-8">
                    <button onclick="app.save()"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-xl shadow-lg transition transform active:scale-95 text-base">
                        <i class="fas fa-save mr-2"></i>ì „ì²´ ì €ì¥
                    </button>
                </div>

            </div>
        </div>
    </main>

    <script type="module">
        window.AuthManager.init('teacher');

        const app = {
            init: function () {
                document.addEventListener('auth-ready', () => {
                    this.loadConfig();
                });
            },

            loadConfig: async function () {
                try {
                    const doc = await window.db.collection('site_settings').doc('interface_config').get();
                    if (doc.exists) {
                        const data = doc.data();
                        document.getElementById('main-emoji').value = data.mainEmoji || 'ğŸ“š';
                        document.getElementById('main-subtitle').value = data.mainSubtitle || 'ìš°ë¦¬ê°€ ì¨ ë‚´ë ¤ê°€ëŠ” ì´ì•¼ê¸°';

                        document.getElementById('dday-enabled').checked = data.ddayEnabled || false;
                        document.getElementById('dday-title').value = data.ddayTitle || '';
                        document.getElementById('dday-date').value = data.ddayDate || '';

                        this.toggleDday();
                    } else {
                        // Defaults
                        document.getElementById('main-emoji').value = 'ğŸ“š';
                        document.getElementById('main-subtitle').value = 'ìš°ë¦¬ê°€ ì¨ ë‚´ë ¤ê°€ëŠ” ì´ì•¼ê¸°';
                        document.getElementById('dday-enabled').checked = false;
                        this.toggleDday();
                    }
                } catch (e) {
                    console.error('Failed to load interface config:', e);
                    // Defaults
                    document.getElementById('main-emoji').value = 'ğŸ“š';
                    document.getElementById('main-subtitle').value = 'ìš°ë¦¬ê°€ ì¨ ë‚´ë ¤ê°€ëŠ” ì´ì•¼ê¸°';
                }
            },

            toggleDday: function () {
                const enabled = document.getElementById('dday-enabled').checked;
                const content = document.getElementById('dday-content');
                if (enabled) {
                    content.classList.remove('opacity-50', 'pointer-events-none');
                } else {
                    content.classList.add('opacity-50', 'pointer-events-none');
                }
            },

            save: async function () {
                const config = {
                    mainEmoji: document.getElementById('main-emoji').value.trim() || 'ğŸ“š',
                    mainSubtitle: document.getElementById('main-subtitle').value.trim() || 'ìš°ë¦¬ê°€ ì¨ ë‚´ë ¤ê°€ëŠ” ì´ì•¼ê¸°',
                    ddayEnabled: document.getElementById('dday-enabled').checked,
                    ddayTitle: document.getElementById('dday-title').value.trim(),
                    ddayDate: document.getElementById('dday-date').value,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                if (config.ddayEnabled && (!config.ddayTitle || !config.ddayDate)) {
                    alert('D-Day ì‚¬ìš© ì‹œ ì œëª©ê³¼ ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                try {
                    await window.db.collection('site_settings').doc('interface_config').set(config);
                    alert('ì¸í„°í˜ì´ìŠ¤ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } catch (e) {
                    alert('ì €ì¥ ì‹¤íŒ¨: ' + e.message);
                }
            }
        };

        window.app = app;
        app.init();
    </script>
</body>

</html>