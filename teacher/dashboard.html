<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµì‚¬ ëŒ€ì‹œë³´ë“œ - Westory</title>
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="../assets/js/firebase-config.js"></script>
    <!-- Styles & Auth -->
    <link rel="stylesheet" href="../assets/css/style.css">
    <script src="../assets/js/auth-manager.js"></script>

    <style>
        .dashboard-container { max-width: 1280px; margin: 40px auto; padding: 0 24px; }
        .card-grid { display: grid; gap: 24px; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        
        .menu-card {
            background: white; border-radius: 12px; padding: 30px 24px; text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s; border: 1px solid #e5e7eb;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; text-decoration: none;
        }
        .menu-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); border-color: #2563eb; }
        .card-icon { font-size: 32px; margin-bottom: 16px; width: 64px; height: 64px; background: #eff6ff; color: #2563eb; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .card-title { font-size: 1.2rem; font-weight: 700; margin-bottom: 8px; color: #111827; }
        .card-desc { color: #6b7280; font-size: 0.9rem; }

        /* Modal Styles */
        .modal-overlay { background-color: rgba(0, 0, 0, 0.5); }
        .switch { position: relative; display: inline-block; width: 48px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #2563eb; }
        input:checked + .slider:before { transform: translateX(24px); }
    </style>
</head>
<body>
    <!-- Header injected by auth-manager.js -->

    <main class="dashboard-container">
        <h1 class="text-3xl font-bold mb-8 text-gray-900" id="welcome-text">ë°˜ê°‘ìŠµë‹ˆë‹¤, ì„ ìƒë‹˜ ğŸ‘‹</h1>

        <!-- Main Menu Cards -->
        <div class="card-grid">
            <a href="quiz-admin.html" class="menu-card">
                <div class="card-icon"><i class="fas fa-puzzle-piece"></i></div>
                <div class="card-title">ì—­ì‚¬ í€´ì¦ˆ ëŒ€ì‹œë³´ë“œ</div>
                <div class="card-desc">í€´ì¦ˆ í˜„í™© ë° í†µê³„ í™•ì¸</div>
            </a>
            <a href="student-list.html" class="menu-card">
                <div class="card-icon"><i class="fas fa-user-graduate"></i></div>
                <div class="card-title">í•™ìƒ ê´€ë¦¬</div>
                <div class="card-desc">í•™ìƒ ëª…ë‹¨ ë° ê¸°ë¡ ì¡°íšŒ</div>
            </a>
            <a href="score-admin.html" class="menu-card">
                <div class="card-icon"><i class="fas fa-chart-bar"></i></div>
                <div class="card-title">ì„±ì  ì‚°ì¶œ ê´€ë¦¬</div>
                <div class="card-desc">ìˆ˜í–‰í‰ê°€ ì…ë ¥ ë° ë“±ê¸‰ ì‚°ì¶œ</div>
            </a>
            <a href="mark-exam-admin.html" class="menu-card">
                <div class="card-icon"><i class="fas fa-check-double"></i></div>
                <div class="card-title">ì‹œí—˜ ì±„ì  ê´€ë¦¬</div>
                <div class="card-desc">ì§€í•„ê³ ì‚¬ ë‹µì•ˆ ë° ì±„ì  ê´€ë¦¬</div>
            </a>
        </div>
    </main>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center">
        <div class="modal-overlay absolute inset-0" onclick="document.getElementById('settings-modal').style.display='none'"></div>
        <div class="bg-white rounded-lg shadow-xl z-10 w-full max-w-md p-6 mx-4">
            <div class="flex justify-between items-center mb-6 pb-4 border-b">
                <h2 class="text-xl font-bold text-gray-900"><i class="fas fa-cog mr-2"></i>í•™ìƒ ë©”ë‰´ í‘œì‹œ ì„¤ì •</h2>
                <button onclick="document.getElementById('settings-modal').style.display='none'" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times fa-lg"></i>
                </button>
            </div>
            
            <div class="space-y-4 mb-8">
                <div class="flex justify-between items-center">
                    <span class="font-bold text-gray-700">ì—­ì‚¬ í€´ì¦ˆ</span>
                    <label class="switch"><input type="checkbox" id="toggle-quiz"><span class="slider"></span></label>
                </div>
                <div class="flex justify-between items-center">
                    <span class="font-bold text-gray-700">í•™ìŠµ ê¸°ë¡</span>
                    <label class="switch"><input type="checkbox" id="toggle-history"><span class="slider"></span></label>
                </div>
                <div class="flex justify-between items-center">
                    <span class="font-bold text-gray-700">ë‚˜ì˜ ì„±ì í‘œ</span>
                    <label class="switch"><input type="checkbox" id="toggle-score"><span class="slider"></span></label>
                </div>
                <div class="flex justify-between items-center">
                    <span class="font-bold text-gray-700">ì‹œí—˜ ì±„ì </span>
                    <label class="switch"><input type="checkbox" id="toggle-mark-exam"><span class="slider"></span></label>
                </div>
            </div>

            <button onclick="saveMenuConfig()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition shadow">
                ì„¤ì • ì €ì¥
            </button>
        </div>
    </div>

    <footer class="text-center py-8 text-gray-400 text-sm border-t mt-auto bg-white">
        Copyright Â© ì—­ì‚¬êµì‚¬ ë°©ì¬ì„. All rights reserved.
    </footer>

    <script>
        // Initialize Auth
        window.AuthManager.init('teacher');

        // Logic to bind the header button to the modal
        document.addEventListener('auth-ready', () => {
            const settingsBtn = document.getElementById('header-settings-btn');
            if(settingsBtn) {
                settingsBtn.addEventListener('click', () => {
                    loadMenuConfig();
                    document.getElementById('settings-modal').style.display = 'flex';
                });
            }
        });

        async function loadMenuConfig() {
            try {
                const doc = await window.db.collection('site_settings').doc('menu_config').get();
                if (doc.exists) {
                    const data = doc.data();
                    document.getElementById('toggle-quiz').checked = data.quiz !== false;
                    document.getElementById('toggle-history').checked = data.history !== false;
                    document.getElementById('toggle-score').checked = data.score !== false;
                    document.getElementById('toggle-mark-exam').checked = data.mark_exam !== false;
                } else {
                    document.querySelectorAll('.switch input').forEach(el => el.checked = true);
                }
            } catch (error) {
                console.error("Config load error:", error);
            }
        }

        async function saveMenuConfig() {
            const config = {
                quiz: document.getElementById('toggle-quiz').checked,
                history: document.getElementById('toggle-history').checked,
                score: document.getElementById('toggle-score').checked,
                mark_exam: document.getElementById('toggle-mark-exam').checked,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                await window.db.collection('site_settings').doc('menu_config').set(config, { merge: true });
                alert("ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
                document.getElementById('settings-modal').style.display = 'none';
            } catch (error) {
                alert("ì €ì¥ ì‹¤íŒ¨: " + error.message);
            }
        }
    </script>
</body>
</html>